### Debian bookworm preseed generated by Valete Preseeder ###
# Generate your own on preseeder.valete.fr

## locales

# Preseeding only locale sets language, country and locale.
d-i debian-installer/locale string en_US

d-i keyboard-configuration/xkb-keymap string us

d-i keyboard-configuration/toggle select No toggling

# Hostname and domain
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string test-pve
d-i netcfg/get_domain string flopo.retropetro.net

## mirror

# If you select ftp, the mirror/country string does not need to be set. Default value for the mirror protocol: http.
d-i mirror/protocol select http
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string 

d-i mirror/country string manual

# Suite to install.
d-i mirror/suite string bookworm

## accounts

# Skip creation of a root account (normal user account will be able to use sudo)
d-i passwd/root-login boolean true

d-i passwd/root-password-crypted password $6$e7pqDzubRiwcuXr/$UXzYpp7371rTigpT3N0bkI90T1sFmzt2FzxQUq9Gi.D0pZjgNdnze79FB9xjXs5mU9Qes0PiZ9VBRckOdw1tO1

# Skip creation of a normal user account.
d-i passwd/make-user boolean true

d-i passwd/user-fullname string Ken Petro

d-i passwd/username string pofo14

d-i passwd/user-password-crypted password $6$e7pqDzubRiwcuXr/$UXzYpp7371rTigpT3N0bkI90T1sFmzt2FzxQUq9Gi.D0pZjgNdnze79FB9xjXs5mU9Qes0PiZ9VBRckOdw1tO1

## Clock and timezone

# Controls whether or not the hardware clock is set to UTC.
d-i clock-setup/utc boolean false
d-i time/zone select US/Eastern

## Partitioning

d-i partman-auto/disk string /dev/disk/by-id/ata-Samsung_SSD_870_EVO_500GB_S6PXNZ0TC05818H
d-i grub-installer/bootdev string /dev/disk/by-id/ata-Samsung_SSD_870_EVO_500GB_S6PXNZ0TC05818H
# Disable LVM
d-i partman-auto/method select regular

# Use simple atomic recipe (creates / + swap, no separate /home or LVM)
d-i partman-auto/choose_recipe select atomic

# Remove pre-existing partitions, LVM, and RAID configs if present
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true

# Confirm partitioning without prompting
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
d-i partman-md/confirm boolean true

# Use UUIDs for mounting (default behavior)
d-i partman/mount_style select uuid


## Apt setup

# If you don't want to have the sources.list entry for a DVD/ BD installation image active in the installed system(entries for netinst or CD images will be disabled anyway, regardless of this setting).
d-i apt-setup/disable-cdrom-entries boolean true

# Select which update services to use; define the mirrors to be used. Values shown below are the normal defaults.
d-i services_select string multiselect security, updates

## Package selection

# 
tasksel tasksel/first multiselect standard, ssh-server

# Individual additional packages to install
d-i pkgsel/include string build-essential curl gnupg2

## Boot loader

# This is fairly safe to set, it makes grub install automatically to the UEFI partition/boot record if no other operating system is detected on the machine.
d-i grub-installer/only_debian boolean true

## Advanced options
# Add SSH Key
# add pofo14 to sudoers
# enable root login
# disable password authentication
# Enable SSH

d-i preseed/late_command string \
  in-target mkdir -p /root/.ssh /home/pofo14/.ssh ; \
  in-target sh -c 'curl -s https://github.com/pofo14.keys > /root/.ssh/authorized_keys' ; \
  in-target install -m 600 /root/.ssh/authorized_keys /home/pofo14/.ssh/authorized_keys ; \
  in-target chmod 700 /root/.ssh /home/pofo14/.ssh ; \
  in-target chown -R pofo14:pofo14 /home/pofo14/.ssh ; \
  in-target sed -i "s/^#\?PermitRootLogin.*/PermitRootLogin prohibit-password/" /etc/ssh/sshd_config ; \
  in-target sed -i "s/^#\?PasswordAuthentication.*/PasswordAuthentication no/" /etc/ssh/sshd_config ; \
  in-target sh -c 'echo "pofo14 ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/pofo14' ; \
  in-target chmod 0440 /etc/sudoers.d/pofo14 ; \
  in-target systemctl restart ssh

d-i finish-install/reboot_in_progress note