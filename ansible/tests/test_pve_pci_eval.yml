---
- name: Test pve_pci_mappings variable evaluation
  hosts: localhost
  gather_facts: false
  connection: local

  vars:
    # default test values (override with -e)
    pve_pci_mappings_list: []
    pve_pci_mappings: []
    pve_pci_mappings_force_create_datacenter_cfg: false
    force_create_datacenter_cfg: false

  tasks:
    - name: Include only eval helper from role
      include_tasks: ../roles/pve_pci_mappings/tasks/eval_vars.yml
      tags: test

    - name: Show computed effective mappings
      ansible.builtin.debug:
        var: pve_pci_mappings_effective

    - name: Show whether creation allowed
      ansible.builtin.debug:
        var: pve_pci_mappings_create_allowed
