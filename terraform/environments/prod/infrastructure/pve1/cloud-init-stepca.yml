#cloud-config
hostname: ${hostname}
fqdn: ${hostname}.flopo.retropetro.net

users:
  - name: stepca
    gecos: Step CA Admin
    primary_group: users
    groups: [sudo, adm]
    shell: /bin/bash
    sudo: ["ALL=(ALL) NOPASSWD:ALL"]
    lock_passwd: false
    ssh_authorized_keys:
%{~ for key in ssh_keys }
      - ${key}
%{~ endfor }

package_update: true
package_upgrade: true

packages:
  - qemu-guest-agent
  - curl
  - vim
  - net-tools
  - openssl
  - jq

runcmd:
  - timedatectl set-timezone America/New_York
  - systemctl enable qemu-guest-agent
  - systemctl start qemu-guest-agent
  - mkdir -p /etc/step-ca
  - mkdir -p /var/lib/step-ca
  - chown -R stepca:stepca /etc/step-ca /var/lib/step-ca

final_message: "Step CA VM ready for Ansible configuration"
